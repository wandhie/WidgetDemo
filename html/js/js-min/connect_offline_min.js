debug=false;debugTiming=false;var undoRules="";var doUpdateUserValues=true;function getImageDirPath(a){return"."+getVariable(a,"imageDirPath")}var APP_DIRECTORY="data";var TXT_EXTENSION=".app";var OFFLINE_CONTROLLER="html/offlineController.html";var MATCH_ALL_SUBSCRIPTS=new RegExp("\\[[^\\]]+]","g");var MATCH_PART_FUNCTIONS=new RegExp("\\.[A-Z]+()");var OPEN_FILE_FOR_READ=1;var OPEN_FILE_FOR_WRITE=2;var OPEN_FILE_FOR_APPEND=8;var PREFIX=0;var SUFFIX=1;var ROW_SUFFIX="_R";var FIELDSET_PREFIX="FS_";var getOfflineFileNamePagePath="html/getOfflineFileName.html";var SW_SYSDATE="SYSDATE";var SW_SYSDATETIME="SYSDATETIME";var SW_SYSTIME="SYSTIME";var SW_SYSDAY="SYSDAY";var SW_SYSMONTH="SYSMONTH";var SW_SYSYEAR="SYSYEAR";var SW_SYSHOUR="SYSHOUR";var SW_SYSHOUR_OF_DAY="SYSHOUR_OF_DAY";var SW_SYSMINUTE="SYSMINUTE";var SW_SYSSECOND="SYSSECOND";var SW_SYSAM_PM="SYSAM_PM";var SW_SYSTIMEMILLIS="SYSTIMEMILLIS";var SW_PAGE="PAGE";var SW_PROCESS="PROCESS";var SW_PHASE="PHASE";var SW_PROJECTHOME="PROJECTHOME";var DAYS_PART="DAY";var MONTHS_PART="MONTH";var YEARS_PART="YEAR";var HOURS_PART="HOUR";var MINUTES_PART="MINUTE";var SECONDS_PART="SECOND";var DATE_FN=".DATE()";var TIME_FN=".TIME()";var DAY_FN=".DAY()";var MONTH_FN=".MONTH()";var YEAR_FN=".YEAR()";var HOUR_FN=".HOUROFDAY()";var MINUTE_FN=".MINUTES()";var SECOND_FN=".SECONDS()";var NOT_REQUIRED="Not Required";var PART_LOOKUP=new Array();PART_LOOKUP.Day=DAY_FN;PART_LOOKUP.Month=MONTH_FN;PART_LOOKUP.Year=YEAR_FN;PART_LOOKUP.Hours=HOUR_FN;PART_LOOKUP.Minutes=MINUTE_FN;PART_LOOKUP.Seconds=SECOND_FN;PART_LOOKUP["Not Required"]=NOT_REQUIRED;var DATE_PART_ID=new Array();DATE_PART_ID.DATE="DATE";DATE_PART_ID.TIME="TIME";DATE_PART_ID.DAY="DAY";DATE_PART_ID.MONTH="MONTH";DATE_PART_ID.YEAR="YEAR";DATE_PART_ID.HOUROFDAY="HOUROFDAY";DATE_PART_ID.MINUTES="MINUTES";DATE_PART_ID.SECONDS="SECONDS";var DEFAULT_DATE_ORDER=new Array();DEFAULT_DATE_ORDER[0]=DAY_FN;DEFAULT_DATE_ORDER[1]=MONTH_FN;DEFAULT_DATE_ORDER[2]=YEAR_FN;var DEFAULT_TIME_ORDER=new Array();DEFAULT_TIME_ORDER[0]=HOUR_FN;DEFAULT_TIME_ORDER[1]=MINUTE_FN;DEFAULT_TIME_ORDER[2]=SECOND_FN;var DEFAULT_DATE_SEP_ORDER=new Array();DEFAULT_DATE_SEP_ORDER[0]="/";DEFAULT_DATE_SEP_ORDER[1]="/";var DEFAULT_TIME_SEP_ORDER=new Array();DEFAULT_TIME_SEP_ORDER[0]=":";DEFAULT_TIME_SEP_ORDER[1]=":";var DEFAULT_DATETIME_ORDER=new Array();DEFAULT_DATETIME_ORDER[0]=DAY_FN;DEFAULT_DATETIME_ORDER[1]=MONTH_FN;DEFAULT_DATETIME_ORDER[2]=YEAR_FN;DEFAULT_DATETIME_ORDER[3]=HOUR_FN;DEFAULT_DATETIME_ORDER[4]=MINUTE_FN;DEFAULT_DATETIME_ORDER[5]=SECOND_FN;var DEFAULT_SEPARATOR_ORDER=new Array();DEFAULT_SEPARATOR_ORDER[0]="/";DEFAULT_SEPARATOR_ORDER[1]="/";DEFAULT_SEPARATOR_ORDER[2]=" ";DEFAULT_SEPARATOR_ORDER[3]=":";DEFAULT_SEPARATOR_ORDER[4]=":";var readOnlyFields=new Array();var readOnlyFieldDisplays=new Array();var stateObjects=new Object();var attributes=new Array();var dollarLookup=null;var pageErrors=new Array();var totalTime=0;var prevTime,currentTime;function logTime(b){if(debugTiming){var a=(new Date()).getTime();totalTime+=(a-prevTime);alert(b+(a-prevTime));prevTime=(new Date()).getTime()}}function update(m){if(debugTiming){alert("Starting update");prevTime=(new Date()).getTime()}var a=document.getElementById("form1");var g=a.elements.PAGE.value;var D=a.elements;parent.CURRENT_PAGE=g;var o=a.elements.PAGE.value;if(parent.getPageState(o)){stateObjects=parent.getPageState(o)}for(var w=0;w<D.length;w++){if(D[w].id&&D[w].name&&D[w].type&&D[w].type!="hidden"&&D[w].type!="button"){var r=stateObjects[D[w].id];if(r){r.node=D[w]}else{r=new stateObj(D[w]);stateObjects[D[w].id]=r}}}logTime("pass1 (setup state objects): ");populateSystemWordsIntoDictionary();var h;if(m){h=new Function(g+"_"+m+"()")}else{h=new Function(g+"_prephase()")}try{h()}catch(x){var E=g.split("_");var g=E[0]+"_"+E[1];var j=parent.navPageSections[g];if(E.length==3){if(j.sectionIndex==0){h=new Function(g+"_prephase()");h()}}}logTime("pass2 (run pre phase rules): ");updateDynamicLists();logTime("pass3 (update dynamic lists): ");var t=new Array();var p=new Array();for(var q in stateObjects){var n=stateObjects[q];if(n.node.type=="hidden"||n.node.type=="button"){continue}var l=document.getElementById(n.node.id);var H=null;if(l&&n.node.name){if(n.node.name.indexOf(UNSELECT_LIST_PREFIX)==0){var f=n.node.name.substring(UNSELECT_LIST_PREFIX.length);H=getSessionValueForPresentation(f);if(debug){alert("UNSELECT_LIST_PREFIX: Value for "+n.node.name+" = "+H)}selectTransferableListValues(l,H)}else{if(n.node.name.indexOf(SELECT_LIST_PREFIX)==0){var f=n.node.name.substring(SELECT_LIST_PREFIX.length);H=getSessionValueForPresentation(f);var v=document.getElementById(f);v.value=H}else{if(n.node.name.indexOf(SINGLE_CHECKBOX_PREFIX)==0){var f=n.node.name.substring(1);H=getSessionValueForPresentation(f);setFieldValue(l,H)}else{if(l.name&&l.name==SELECTALL_NAME){t.push(l)}else{H=getSessionValueForPresentation(n.node.name);if(debug){alert("Value for "+n.node.name+" = "+H)}if(l.id&&endsWith(l.id,SELECTOR_INDICATOR+"R1")){p.push(l)}if(H==null||H=="undefined"||H==""){H=""+getElementValue(l);if(H!=null&&H!=""&&!l.disabled){setDefaultSessionValue(n.node.name,H)}}setFieldValue(l,H)}}}}if(H!=null&&H.length>0){if(l.value==H){n.displayText=H;n.node.value=H}}}}logTime("pass4 (populate values): ");updateDynamicMandatoryFields();logTime("pass5 (update dynamic mand fields): ");updateDynamicReadOnlyFields();logTime("pass6 (update dynamic read only fields): ");updateTables(t,p);logTime("pass7 (update tables): ");if(dollarLookup){for(var q in dollarLookup){var B=document.getElementById(q);if(B){B.innerHTML=tokenReplace(dollarLookup[q])}}offlineSetupScript()}else{var G=document.getElementsByTagName("body")[0];var F=new Array();addElement(G,"div",F);addElement(G,"span",F);addElement(G,"td",F);addElement(G,"th",F);addElement(G,"table",F);addElement(G,"fieldset",F);addElement(G,"input",F);addElement(G,"select",F);addElement(G,"a",F);addElement(G,"button",F);for(var w=0;w<F.length;w++){var B=F[w];if(B.tagName=="TR"){continue}if(B.id&&(B.id.indexOf("p1_")==0||B.id.indexOf("p4_")==0||B.id.indexOf("TXT_")==0)){var A=B.innerHTML;if(A.indexOf("$$")>=0&&A.indexOf("<TABLE")<0){var b=A.indexOf("checkHiddenOffline(");if(b<0){var C;var s;if(A.indexOf("[C]")>=0){var z=getParentNode(B,"table");if(z&&z.id&&attributes[z.id]&&attributes[z.id].DataGroupsToIncrement){var e=getParentNode(B,"tr");var k=e.id;if(k.indexOf("_R")>0){var c=k.substring(k.lastIndexOf("_R")+2);s=attributes[z.id].DataGroupsToIncrement;C=parent.dataGroupInstances[s];parent.dataGroupInstances[s]=c}}}if(!dollarLookup){dollarLookup=new Array()}dollarLookup[B.id]=A;B.innerHTML=tokenReplace(A,false,true);if(C!=null&&s!=null){parent.dataGroupInstances[s]=C}}else{var d=A.indexOf(")",b);var u=A.substring(b,d);if(A.indexOf("$$")<b||A.indexOf("$$")>d){var y=tokenReplace(A.substring(0,b),false,true);y+=u;y+=tokenReplace(A.substring(d),false,true);B.innerHTML=y}}}}}}logTime("pass8 (final $$...$ replacement): ");if(debugTiming){alert("total time = "+totalTime)}parent.addPageState(o,stateObjects)}function updateTables(g,b){for(var a=0;a<b.length;a++){var f=getParentNode(b[a],"tbody");if(f&&f.childNodes&&f.childNodes.length){if(f.childNodes[1].onmouseout&&f.childNodes[1].onmouseout.toString().indexOf("mouseLeft")>-1){f.childNodes[1].onmouseout()}}}for(var a=0;a<g.length;a++){var c=g[a];var h=false;var f=getParentNode(c,"tbody");if(f&&f.childNodes&&f.childNodes.length){h=true;for(var e=1;e<f.childNodes.length;e++){if(f.childNodes[e].innerHTML){var d=getSelector(f.childNodes[e]);if(d==null||!d.checked){h=false;break}}}}c.checked=h}var j=document.getElementsByTagName("table");for(var e=0;e<j.length;e++){var k=j[e];updateHiddenRowsInTable(k)}}function checkRowHidden(){}function updateHiddenRowsInTable(c){if(c.id&&attributes[c.id]!=null){if(attributes[c.id].NoEmptyRows=="true"){var f=getLastInstance(attributes[c.id].DataGroupsToIncrement);var d=c.getElementsByTagName("tr");for(var b=1;b<d.length;b++){if(b>f){d[b].style.display="none"}}if(f==0){var a=document.createElement("td");a.innerHTML=""+attributes[c.id].NoRecordsMessage;var e=document.createElement("tr");e.appendChild(a);c.appendChild(e)}}}}function getBaseId(c,b,a){c=c.toUpperCase();b=b.toUpperCase();if(PREFIX==a){if(c.indexOf(b)==0){c=c.substring(b.length)}}else{if(SUFFIX==a){if(c.lastIndexOf(b)>0){c=c.substring(0,c.lastIndexOf(b))}}}return c}function removeSuffixOrPrefixFromId(b,a){b=getBaseId(b,SELECT_LIST_PREFIX,PREFIX);b=getBaseId(b,UNSELECT_LIST_PREFIX,PREFIX);b=getBaseId(b,SEL_BTN_PREFIX,PREFIX);b=getBaseId(b,SELALL_BTN_PREFIX,PREFIX);b=getBaseId(b,DESEL_BTN_PREFIX,PREFIX);b=getBaseId(b,DESELALL_BTN_PREFIX,PREFIX);b=getBaseId(b,DATE_SUFFIX,SUFFIX);b=getBaseId(b,TIME_SUFFIX,SUFFIX);b=getBaseId(b,DAY_SUFFIX,SUFFIX);b=getBaseId(b,MONTH_SUFFIX,SUFFIX);b=getBaseId(b,YEAR_SUFFIX,SUFFIX);b=getBaseId(b,HOURS_SUFFIX,SUFFIX);b=getBaseId(b,MINUTES_SUFFIX,SUFFIX);b=getBaseId(b,SECONDS_SUFFIX,SUFFIX);b=getBaseId(b,ROW_SUFFIX,SUFFIX);b=getBaseId(b,FIELDSET_PREFIX,PREFIX);if(!a){b=getBaseId(b,"_",SUFFIX)}return b}function stateObj(a){this.node=a;this.type=a.type;this.baseId=removeSuffixOrPrefixFromId(this.node.id,this.type!="radio"&&this.type!="checkbox");this.readOnly=getNodeReadOnly(this.baseId);this.displayType=getNodeDisplayType(this.baseId);this.displayText=getNodeRODisplayText(this.node);this.divInnerHTML;this.mandatory=getNodeMandatory(this.baseId,this.node.id);this.mandMessage=getNodeMandMessage(this.baseId,this.node.id)}function getNodeReadOnly(c){c=removeSuffixOrPrefixFromId(c,true);var b=false;for(var a=0;a<readOnlyFields.length;a++){if(c==readOnlyFields[a]){b=true;break}}return b}function getNodeRODisplayText(a){var b=getElementDisplayValue(a);return b}function getNodeDisplayType(a){var b=readOnlyFieldDisplays[a];if(b==null||b.length==0){b="Text"}return b}function getElementDisplayValue(b,e){if(e==null){e=""}if(b.type=="text"||b.type=="textarea"||b.type=="password"||b.type=="file"||b.type=="hidden"){return b.value}else{if(b.type=="select-one"){for(var c=0;c<b.length;c++){if(b[c].selected&&b[c].value.length>0){return b[c].text}}return""}else{if(b.type=="select-multiple"){var a="";var d=0;if(b.id!=null&&b.id.indexOf(SELECT_LIST_PREFIX)==0){for(var c=0;c<b.length;c++){if(c>0){a+="|"}if(b.options[c].value.length>0){a+=b.options[c].text}}}else{for(var c=0;c<b.length;c++){if(b.options[c].selected&&b.options[c].value.length>0){if(d>0){a+="|"}a+=b.options[c].text;d++}}}return a}else{if(b.type=="checkbox"){var a="";var d=0;var g;if(b.id.indexOf("_Selector_")>0){return""}else{g=b.parentNode.parentNode.getElementsByTagName("input")}if(b.name!=null&&(b.name.indexOf(SINGLE_CHECKBOX_PREFIX)==0)){var f="";if(g[0].checked){f=g[0].value.substring(0,g[0].value.indexOf("|"))}else{f=g[0].value.substring(g[0].value.indexOf("|")+1)}g[1].value=f;return f}for(var c=0;c<g.length;c++){if(g[c].checked&&!g[c].parentNode.disabled){if(d>0){a+="|"}a+=g[c].parentNode.childNodes[1].innerHTML;d++}}return a}else{if(b.type=="radio"){if(b.name==null||b.name==""){return""}var g;if(b.id.indexOf("_Selector_")>0){return""}else{g=b.parentNode.parentNode.getElementsByTagName("input")}for(var c=0;c<g.length;c++){if(g[c].checked){return g[c].parentNode.childNodes[1].innerHTML}}return""}else{if(b.type==null&&b[0]!=null){if(b[0].type=="radio"){for(var c=0;c<b.length;c++){if(b[c].checked){return b[c].parentNode.childNodes[1].innerHTML}}}return""}}}}}}}function getNodeMandatory(a,c){var b=document.getElementById("MM_"+a);if(b!=null){mand=true}else{mand=false}return mand}function getNodeMandMessage(a,d){var b=document.getElementById("MM_"+a);var c="";if(b){c=b.innerHTML}return c}function updateDynamicReadOnlyFields(){var g=parent.getCurrentProcessAndPhase();var c=parent.getCurrentProcess();var i=g;var a=null;var f=false;var d=new Array();if((readOnlyStateObj=parent.questionState["phase_"+i])!=null){f=true}else{if((readOnlyStateObj=parent.questionState["process_"+c])!=null){f=true}}for(var b in stateObjects){var e=stateObjects[b];if(e.node.type=="hidden"){continue}if(e.node.name&&e.node.id&&(!e.node.id.indexOf(SELECT_LIST_PREFIX)==0)){if(!fieldProcessed(d,e)){if(!f){if(parent.questionState[e.baseId]!=null){var h=parent.questionState[e.baseId];e.readOnly=h}updateReadOnlyQuestion(e);delete parent.questionState[e.baseId]}else{evalReadOnlyQuestion(e,readOnlyStateObj)}if(isRowId(e.node.id)){d.push(e.node.id)}else{d.push(e.baseId)}}}}if(f){delete parent.questionState["phase_"+i];delete parent.questionState["process_"+c]}}function evalReadOnlyQuestion(d,b){var e=b.state;var c=b.ignoreCurrentState;var a=readOnlyFields.join();if(a.indexOf(d.baseId)>=0&&c){e=true}else{e=b.state}d.readOnly=e;updateReadOnlyQuestion(d)}function fieldIsReadOnly(b,c,a){var d;if(!c&&b&&!a){d=false}else{if(!c&&!b){d=false}else{d=true}}return d}function updateReadOnlyQuestion(j){var b=false;var d=false;var g;if(j.node.id!=null){var c="";if(j.node.id.indexOf(UNSELECT_LIST_PREFIX)==0){c=j.node.id.substring(UNSELECT_LIST_PREFIX.length)}else{if(j.node.id.indexOf(SELECT_LIST_PREFIX)==0){c=j.node.id.substring(SELECT_LIST_PREFIX.length)}}if(c.length>0){b=true}if(isRadio(j.node)||isCheckBox(j.node)){d=true}if(j.displayType=="Text"){if(j.node.id.indexOf(".")>-1){var e=j.node.id.substring(j.node.id.indexOf(".")+1);if(e in DATE_PART_ID){var k=document.getElementById(j.node.id);var a=k.className;if(a==null||a.length==0){a=k.parentNode.className}for(e in DATE_PART_ID){var l=j.baseId+"."+e;var n=document.getElementById(l);if(n!=null){setDatePartReadOnlyText(j,n,a)}}return}}setNodeReadOnlyText(j)}else{if(b){var k=new Array();k[0]=document.getElementById(UNSELECT_LIST_PREFIX+c);k[1]=document.getElementById(SELECT_LIST_PREFIX+c);k[2]=document.getElementById(SEL_BTN_PREFIX+c);k[3]=document.getElementById(SELALL_BTN_PREFIX+c);k[4]=document.getElementById(DESEL_BTN_PREFIX+c);k[5]=document.getElementById(DESELALL_BTN_PREFIX+c);for(var h=0;h<k.length;h++){setNodeReadOnlyDisabled(k[h],j.readOnly)}}else{if(d){var m=0;var k=document.getElementById(j.node.id);while(k!=null){setNodeReadOnlyDisabled(k,j.readOnly);m++;var f;if(j.node.id.indexOf(ROW_SUFFIX)>0){f=j.node.id.substring(0,j.node.id.indexOf(ROW_SUFFIX))+"_"+m+j.node.id.substring(j.node.id.indexOf(ROW_SUFFIX))}else{f=j.node.id+"_"+m}k=document.getElementById(f)}}else{var k=document.getElementById(j.node.id);setNodeReadOnlyDisabled(k,j.readOnly)}}}}}function setNodeReadOnlyDisabled(a,b){if(b){a.disabled=true;a.readOnly=true}else{a.disabled=false;a.readOnly=false}}function setDatePartReadOnlyText(e,a,b){if(e.readOnly){try{a.copyOfOuterHTML=a.outerHTML;var d=getNodeRODisplayText(a);var f="<span class='"+b+"'>"+d+"</span>";a.outerHTML=f}catch(c){}}else{if(a.copyOfOuterHTML!=null&&a.copyOfOuterHTML.length>0){a.outerHTML=a.copyOfOuterHTML;a.copyOfOuterHTML=""}}}function setNodeReadOnlyText(e){var d=getDivForNode(e);if(d!=null){if(e.readOnly){try{var a=document.getElementById(e.node.id);var b=a.className;if(b==null||b.length==0){b=a.parentNode.className}e.divInnerHTML=d.innerHTML;e.displayText=getNodeRODisplayText(a);var f="<span class='"+b+"'>"+e.displayText+"</span>";d.innerHTML=f}catch(c){}}else{if(e.divInnerHTML!=null&&e.divInnerHTML.length>0){d.innerHTML=e.divInnerHTML;e.divInnerHTML=""}}}}function getDivForNode(c){var a=c.node;while(a){a=a.parentNode;if(a&&a.id&&a.id.indexOf("p4_")==0){break}}if(a!=null&&a.nodeName!="div"&&a.nodeName!="DIV"&&a.childNodes.length>0){var b=a.id;a=document.getElementById(b).childNodes.item(0)}return a}function isRowId(d){row=false;var b=d.indexOf(ROW_SUFFIX);if(b>0){var c=d.substring(b+2);try{parseInt(c);row=true}catch(a){}}return row}function fieldProcessed(a,e){var b="";var f=e.node.id;if(isRowId(f)){b=f}else{b=e.baseId}var d=false;for(var c=0;c<a.length;c++){if(a[c]==b){d=true;break}}return d}function updateDynamicMandatoryFields(){var c=document.getElementById("form1");var h=parent.getCurrentProcessAndPhase();var b=parent.getCurrentProcess();var i=h;var d=null;var g=false;var e=new Array();if((d=parent.questionMandatoryState["phase_"+i])!=null){g=true}else{if((d=parent.questionMandatoryState["process_"+b])!=null){g=true}}for(var a in stateObjects){var f=stateObjects[a];if(f.node.type=="hidden"||f.node.type=="button"||f.node.id.toUpperCase().indexOf(UNSELECT_LIST_PREFIX)==0){continue}if(f.node.id&&f.node.id.length>0){if(!fieldProcessed(e,f)){if(!g){d=null;d=parent.questionMandatoryState[f.baseId];if(d!=null){f.mandatory=d.state;f.mandMessage=d.mandMessage}updateMandQuestion(f);delete parent.questionMandatoryState[f.baseId]}else{evalMandQuestion(f,d)}if(isRowId(f.node.id)){e.push(f.node.id)}else{e.push(f.baseId)}}}}if(g){delete parent.questionMandatoryState["phase_"+i];delete parent.questionMandatoryState["process_"+i]}}function evalMandQuestion(e,b){var d=b.state;var c=e.mandatory;var f=b.ignoreCurrentState;var a=b.mandMessage;d=fieldIsMandatory(c,d,f);e.mandatory=d;e.mandMessage=b.mandMessage;updateMandQuestion(e)}function fieldIsMandatory(a,c,b){var d;if(!c&&a&&!b){d=false}else{if(!c&&!a){d=false}else{d=true}}return d}function updateMandQuestion(h){var f="";if(isRowId(h.node.id)){var f=h.node.id;f="p1_"+f.substring(0,f.indexOf(ROW_SUFFIX))}else{f="p2_"+h.baseId}var g=document.getElementById(f);if(g){var c;if(g.childNodes.length==1){c=g.childNodes[0]}else{c=g}if(isRowId(h.node.id)){if(c.hasChildNodes()&&c.lastChild.tagName&&c.lastChild.tagName.toUpperCase()=="SPAN"){c=c.lastChild}else{var d=document.createElement("SPAN");d.setAttribute("class","textMedium");c.appendChild(d);c=d}}var b=document.getElementById(h.node.id);if(!b){b=document.getElementById(FIELDSET_PREFIX+h.node.id)}var e=getParentNode(b,"DIV");if(h.mandatory){var a=getVariable("","MANDCHAR");if(!a){a="*"}c.innerHTML=a;if(e){e.setAttribute("title",h.mandMessage)}}else{c.innerHTML="&nbsp;";if(e){e.setAttribute("title","")}}}else{var b=document.getElementById(h.node.id);if(!b){b=document.getElementById(FIELDSET_PREFIX+h.node.id)}if(b){var e=getParentNode(b,"DIV");if(e){if(h.mandatory){e.setAttribute("title",h.mandMessage)}else{e.setAttribute("title","")}}}}}function getOriginalCheckboxValue(b,d){if(d==null){d=""}if(b.type=="checkbox"){var a="";var c=0;var f=b.parentNode.parentNode.getElementsByTagName("input");var e="";e=f[0].value;return e}}function getSingleCheckboxGroupValue(a,c){if(c==null){c=""}if(a.type=="checkbox"){var e=a.parentNode.parentNode.getElementsByTagName("input");if(e.length==3){var b=a.alt;var d="";if(e[0].checked){d=b.substring(0,b.indexOf("|"))}else{d=b.substring(b.indexOf("|")+1)}return d}}}function findDeepestNode(d){var c=d;var b=0;while(c.hasChildNodes()&&c.childNodes[0].tagName!=null){var a=false;for(b=0;b<c.childNodes.length;b++){if((c.childNodes[b].tagName!=null)&&(c.childNodes[b].tagName.toLowerCase()!="legend")){a=true;break}}if(a){c=c.childNodes[b]}}return c}function resetDynamicListValues(b){var d=false;for(var c=(b.length-1);c>=0;c--){if(d){b.splice(c,1)}else{var a=b[c];if(a.resetList){d=true}}}}function removeListItems(a){var c;for(var b=(a.childNodes.length-1);b>=0;b--){c=a.childNodes[b];a.removeChild(c)}}function resetStaticListValues(k,a){resetList=false;for(var d=0;d<k.length;d++){var f=k[d];if(f.resetList){resetList=true;break}}if(resetList){var e=new Array();var c=document.all?document.all:document.getElementsByTagName("*");for(var d=0;d<c.length;d++){if(c[d].listname&&c[d].listname.length>0&&c[d].listname.toUpperCase()==a){e.push(c[d])}}for(var d=0;d<e.length;d++){var g=e[d];var h=g.type;if(!h){h=g.listtype}if(h){h=h.toUpperCase();if(h=="RADIO"||h=="CHECKBOX"){removeListItems(g)}else{if(h=="SELECT-ONE"||h=="SELECT-MULTIPLE"){for(var b=(g.options.length-1);b>=0;b--){if(g[b].value){g.remove(b)}}}}}}}}function addElement(e,c,d){var b=e.getElementsByTagName(c);for(var a=0;a<b.length;a++){d[d.length]=b[a]}}function updateDynamicLists(){var o=new Array();var e=new Array();addElement(document,"select",e);addElement(document,"fieldset",e);for(var r=0;r<e.length;r++){if(e[r].listname!=null&&e[r].listname.length>0){o.push(e[r])}}for(var q=0;q<o.length;q++){var t=o[q];var d=t.type;if(d==null){d=t.listtype;if(d==null){d="radio"}else{d=d.toLowerCase()}}var s=new Array();if(t.name&&t.name.indexOf(SELECT_LIST_PREFIX)==0){}else{if(t.name&&t.name.indexOf(UNSELECT_LIST_PREFIX)==0){var f=t.name.substring(UNSELECT_LIST_PREFIX.length);f=processName(f);var u=(t.listname).toUpperCase();var v=parent.getSessionListValues(u);resetStaticListValues(v,u);var a=parent.getSessionListValues(f);s=v.concat(a)}else{var u=(t.listname).toUpperCase();var v=parent.getSessionListValues(u);resetStaticListValues(v,u);var f=t.name;if(f!=null&&f.length>0){f=processName(f);var a=parent.getSessionListValues(f);s=v.concat(a)}}}resetDynamicListValues(s);var h=0;if(d.indexOf("select")==0&&t.name.indexOf(SELECT_LIST_PREFIX)!=0){var k=0;for(var r=0;r<t.options.length;r++){if(t.options[r].id!=null){k++}}for(var r=0;r<s.length;r++){var p=s[r];var m=document.createElement("OPTION");var l=document.createTextNode(tokenReplace(p.value));m.setAttribute("value",tokenReplace(p.key));var n=tokenReplace(p.groupValue)+"__"+t.id+"_"+k;m.setAttribute("id",n);m.appendChild(l);t.appendChild(m)}}else{if(d=="radio"||d=="checkbox"){var k=-1;for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].id!=null){k++}}for(var r=0;r<s.length;r++){var p=s[r];var n=t.id+"_"+k;var g=document.createElement("<INPUT TYPE='"+d+"' ID='"+n+"' NAME='"+t.name+"' VALUE='"+tokenReplace(p.key)+"' ALT='"+tokenReplace(p.groupValue)+"'>");var c=document.createElement("<LABEL FOR='"+n+"'>");var w=document.createTextNode(tokenReplace(p.value));var b=document.createElement("<SPAN>");c.appendChild(w);b.appendChild(g);b.appendChild(c);t.appendChild(b);if(t.liststyle=="Vertical"){t.appendChild(document.createElement("<br>"))}}}}}}function setFieldValue(l,c){var b=l.name;if(b==null){b=""}else{b=b.toUpperCase()}if(l.tagName=="textarea"||l.type=="text"||l.tagName=="TEXTAREA"||l.type=="TEXT"){l.value=c}else{if(l.tagName=="select"||l.tagName=="SELECT"){var a=l.options;var k=c.split("|");for(var f=0;f<a.length;f++){a[f].selected=false;for(var e=0;e<k.length;e++){if(a[f].value==k[e]){a[f].selected=true;break}}}}else{if(isRadio(l)&&l.name.length>0){var g=document.getElementsByName(l.name);for(var f=0;f<g.length;f++){if(g[f].value==c){g[f].checked=true;return}}}else{if(isCheckBox(l)&&l.name.length>0){var d=new Array(),m;d=document.getElementsByName(l.name);var k=c.split("|");if(d.length==1){var h=getOriginalCheckboxValue(l);if(c==h.substring(0,h.indexOf("|"))){d[0].checked=true;return}}else{for(var f=0;f<d.length;f++){d[f].checked=false;for(var e=0;e<k.length;e++){if(d[f].value==k[e]){d[f].checked=true;break}}}}}}}}}function selectTransferableListValues(a,d){if(d&&d.length>0){var c=d.split("|");for(var b=0;b<a.length;b++){a.options[b].selected=false}for(var b=0;b<a.length;b++){for(i2=0;i2<c.length;i2++){if(a.options[b].value==c[i2]){a.options[b].selected=true;break}}}}}function lookupListValue(h,a,j,g){h=processName(h);if(a&&a.length>0){a=a.toUpperCase();var f=parent.getListDictionaryValues(a);var k=parent.getSessionListValues(a);var l=parent.getSessionListValues(h);var d=f.concat(k);d=d.concat(l);var e;var c;for(var b=0;b<d.length;b++){e=d[b];if(e.key==j){if(g==VALUE_FN){return e.value}else{if(g==GROUP_VALUE_FN){return e.groupValue}}}}}return j}function getListValue(a,f,g,e){var d=splitstring(g,"|",false);var c="";for(var b=0;b<d.length;b++){if(b>0){c+="|"}c+=lookupListValue(a,f,d[b],e)}return c}function updateListFunctionValues(b,d,f,e){var c=getListValue(b,d,f,VALUE_FN);if(c&&c.length>0){setSessionValueForPresentation(b+VALUE_FN,c,e)}var a=getListValue(b,d,f,GROUP_VALUE_FN);if(a&&a.length>0){setSessionValueForPresentation(b+GROUP_VALUE_FN,a,e)}}function updateUserValues(){var e=document.getElementById("form1");var b=e.elements;var h;for(var d=0;d<b.length;d++){var g=b[d].name;if(g==null){g=""}else{g=g.toUpperCase()}if(b[d].disabled||b[d].type=="hidden"||b[d].type=="button"||(g.indexOf(UNSELECT_LIST_PREFIX)==0)){continue}else{if(isHidden(b[d])){continue}else{if(g.indexOf(SELECT_LIST_PREFIX)==0){var c=g.substring(SELECT_LIST_PREFIX.length);var f=document.getElementById(c);h=f.value;if(h){setSessionValueForPresentation(c,h)}}else{if(g.indexOf(SINGLE_CHECKBOX_PREFIX)==0){h=getElementValue(b[d]);var a=g.substring(1);if(h!=null&&a!=null){setSessionValueForPresentation(a,h)}}else{if(b[d].name!=null){h=getElementValue(b[d]);var a=b[d].name;if(h!=null){setSessionValueForPresentation(a,h)}}}}}}}}function processName(b){b=b.toUpperCase();b=trim(b);while(b.indexOf(" ")>=0){b=b.substring(0,b.indexOf(" "))+b.substring(b.indexOf(" ")+1)}if(b.indexOf("[C]")>=0){var c=b.substring(0,b.indexOf("[C]"));var a=parent.dataGroupInstances[c];if(a==null||a=="undefined"||a=="0"){a="1";parent.dataGroupInstances[c]="1";parent.dataGroupInstancesValid[c]=false}b=c+"["+a+"]"+b.substring(b.indexOf("[C]")+3)}if(b.indexOf("[C]")>=0){b=processName(b)}return b}function getMaxInstances(a){var c=parent.dataGroupMaxInstances[a];if(c==null||c=="undefined"||c=="0"){var b=changeSubsToOne(a);c=parent.dataGroupMaxInstances[b];if(c==null||c=="undefined"||c=="0"){c="1"}parent.dataGroupMaxInstances[a]=c}return(c)}function changeSubsToOne(a){var b=a.replace(MATCH_ALL_SUBSCRIPTS,"[1]");return b}function processPGName(a){if(a.charAt(a.length-1)=="]"){var b=a.lastIndexOf("[");a=a.substring(0,b)}return processName(a)}function getFormTableElement(a){var b=getParentNode(a,"table");while(b!=null){if(b.id&&b.id.indexOf("TBL_")==0){break}else{b=getParentNode(b,"table")}}return b}function checkHiddenOffline(t,c,h,k,m,v,q,s){if(doUpdateUserValues){updateUserValues()}var r="";if(s.id){r=s.id}var d=new Array();for(var w in parent.dataGroupInstances){d[w]=parent.dataGroupInstances[w]}var g=splitstring(t,"^",false);var p=splitstring(c,"^",false);var u=splitstring(h,"^",false);var j=splitstring(k,"^",false);var e=splitstring(m,"^",false);for(var l=0;l<p.length;l++){var b=getRowPart(g[l]);if(b.length>0){var a=document.getElementById(g[l]);if(a){var o=getFormTableElement(a);if(o){setDataGroupInstance(attributes[o.id].DataGroupsToIncrement,b)}}}var f=tokenReplace(p[l],true,false,false,true);f=f.replace(/ OR /g," || ");f=f.replace(/ AND /g," && ");checkHidden(g[l],f,u[l],j[l],e[l],v,"")}for(var w in d){parent.dataGroupInstances[w]=d[w]}if(!doUpdateUserValues){var n=document.getElementById(t);if(n!=null){var o=getParentNode(n,"table");if(o!=null){updateHiddenRowsInTable(o)}}}}function tokenReplace(d,b,i,n,m){if(!i){i=false}if(!n){n=false}if(!m){m=false}var c="";while(true&&d){var g=null;var f=d.indexOf("$$!");if(f>=0){var h=d.indexOf("$",f+2);if(h>=4){g=d.substring(f+3,h);tokVal=tokenReplaceVariable(g)}else{break}}else{f=d.indexOf("$$");var e=d.indexOf("$%");if(f>=0){var h=d.indexOf("$",f+2);if(h>=3){g=d.substring(f+2,h);if(i){tokVal=getSessionValueForPresentation(g)}else{tokVal=getSessionValue(g,false,m)}var l=processName(g);c=getPropertyAttribute(l,parent.DATA_TYPE_KEY);if(c=="Date"){var j=trim(d.substring(h+1)).split(" ");if(tokVal&&tokVal!=""&&j.length==3){d=rollDate(l,tokVal,j[1],j[0],j[2]);tokVal=null;break}else{if(n){tokVal=getSessionValue(g+".YEAR()")+getSessionValue(g+".MONTH()")+getSessionValue(g+".DAY()")}}}}else{break}}else{if(e>0){d=d.substring(0,e)+d.substring(d.lastIndexOf("$")+1)}else{break}}}if(g!=null&&tokVal!=null){var a=b;if(a){try{tokVal=""+tokVal;a=(tokVal!=""&&(c=="Number"||c=="Decimal"))?false:b}catch(k){a=b}}if(a){if(d.charAt(f-1)=='"'||d.charAt(f-1)=="'"){d=d.substring(0,f)+tokVal+d.substring(h+1)}else{d=d.substring(0,f)+"'"+tokVal+"'"+d.substring(h+1)}}else{d=d.substring(0,f)+tokVal+d.substring(h+1)}}}return d}function tokenReplaceVariable(a){var b=getSessionVariable(a);if(b==null||b.length==0){b=getGlobalVariable(a)}if(b==null||b.length==0){b=""}if(b.length>0){if(b.indexOf("$$")==0){b=tokenReplace(b)}}return b}function lookupDateTimeSystemWords(a){var f=0,c,d,h,b;var e=a.split(" ");var g=e.length;if(g==3&&(a.indexOf(SW_SYSYEAR)>-1||a.indexOf(SW_SYSMONTH)>-1||a.indexOf(SW_SYSDAY)>-1||a.indexOf(SW_SYSHOUR_OF_DAY)>-1||a.indexOf(SW_SYSHOUR)>-1||a.indexOf(SW_SYSMINUTE)>-1||a.indexOf(SW_SYSSECOND)>-1||a.indexOf(SW_SYSAM_PM)>-1)){c=e[0];d=e[1];h=e[2];f=parent.sessionDictionary[c];if(f!=null){if(c.indexOf(SW_SYSAM_PM)>-1){if("AM"==f){f="0"}else{f="1"}}f=parseInt(f);h=parseInt(h);if(d=="-"){f=(f*1)}f=(f+h);f=formatDigits(""+f);return f}}else{if(g==4&&(a.indexOf(SW_SYSDATE)>-1||a.indexOf(SW_SYSDATETIME)>-1||a.indexOf(SW_SYSTIME)>-1)){c=e[0];d=e[1];h=e[2];b=e[3].toUpperCase();if(d=="-"){d="Decrement"}else{d="Increment"}if(b.indexOf("DAY")==0){b=DAY_FN}else{if(b.indexOf("MONTH")==0){b=MONTH_FN}else{if(b.indexOf("YEAR")==0){b=YEAR_FN}else{if(b.indexOf("HOUR")==0){b=HOUR_FN}else{if(b.indexOf("MINUTE")==0){b=MINUTE_FN}else{if(b.indexOf("SECOND")==0){b=SECOND_FN}}}}}}var i=parent.sessionDictionary[SW_SYSDATETIME];var f=rollDate(c,i,h,d,b);return f}else{f=parent.sessionDictionary[a];return f}}}function rollDate(i,c,j,q,l){var o=DEFAULT_DATETIME_ORDER;var f=DEFAULT_SEPARATOR_ORDER;if(c.indexOf(":")<0){o=DEFAULT_DATE_ORDER;f=DEFAULT_DATE_SEP_ORDER}var h=splitDateTimeIntoParts(i,c,o,f,"0");var n=0,m=0,p=0,e=0,d=0,b=0;if(parseInt(h[YEAR_FN],10)){n=parseInt(h[YEAR_FN],10)}if(parseInt(h[MONTH_FN],10)){m=parseInt(h[MONTH_FN]-1,10)}if(parseInt(h[DAY_FN],10)){p=parseInt(h[DAY_FN],10)}if(parseInt(h[HOUR_FN],10)){e=parseInt(h[HOUR_FN],10)}if(parseInt(h[MINUTE_FN],10)){d=parseInt(h[MINUTE_FN],10)}if(parseInt(h[SECOND_FN],10)){b=parseInt(h[SECOND_FN],10)}var k=new Date(n,m,p,e,d,b);var a=parseInt(j,10);if(q=="Decrement"||q=="-"){a=(a*-1)}if((l==DAY_FN||DAYS_PART.indexOf(l)>=0)&&(!i.indexOf(SW_SYSTIME)>-1)){k.setDate(k.getDate()+a)}else{if((l==MONTH_FN||MONTHS_PART.indexOf(l)>=0)&&(!i.indexOf(SW_SYSTIME)>-1)){k.setMonth(k.getMonth()+a)}else{if((l==YEAR_FN||YEARS_PART.indexOf(l)>=0)&&(!i.indexOf(SW_SYSTIME)>-1)){k.setYear(k.getYear()+a)}else{if(l==HOUR_FN||HOURS_PART.indexOf(l)>=0){k.setHours(k.getHours()+a)}else{if(l==MINUTE_FN||MINUTES_PART.indexOf(l)>=0){k.setMinutes(k.getMinutes()+a)}else{if(l==SECOND_FN||SECONDS_PART.indexOf(l)>=0){k.setSeconds(k.getSeconds()+a)}}}}}}h[DAY_FN]=formatDigits(k.getDate());h[MONTH_FN]=formatDigits(k.getMonth()+1);h[YEAR_FN]=k.getYear();h[HOUR_FN]=formatDigits(k.getHours());h[MINUTE_FN]=formatDigits(k.getMinutes());h[SECOND_FN]=formatDigits(k.getSeconds());if(i.indexOf(SW_SYSDATETIME)>-1){o=DEFAULT_DATETIME_ORDER;f=DEFAULT_SEPARATOR_ORDER}else{if(i.indexOf(SW_SYSDATE)>-1){o=DEFAULT_DATE_ORDER;f=DEFAULT_DATE_SEP_ORDER}else{if(i.indexOf(SW_SYSTIME)>-1){o=DEFAULT_TIME_ORDER;f=DEFAULT_TIME_SEP_ORDER}}}var g=getFormattedDateTimeString(h,o,f,"00");return g}function lookupFunctionValues(d,e){var c="";if(isDatePartFunctionName(d)){var f=d.lastIndexOf(".");var a=d.substring(0,f);c=parent.sessionDictionary[a];c=formatValue(d,c,e)}else{if(d.indexOf("()")==d.length-2){var j=d.lastIndexOf(".");var b=getFunctionName(d,false).toUpperCase();d=d.substring(0,j).toUpperCase();if(b==VALUE_FN||b==GROUP_VALUE_FN){var g=processName(d)+b;c=parent.sessionDictionary[g]}else{var h=processPGName(d);if(b==INSTANCE_FN){c=parent.dataGroupInstances[h]}else{if(b==MAX_INSTANCE_FN){c=parent.dataGroupMaxInstances[h]}else{if(b==LAST_INSTANCE_FN){c=getLastInstance(h)}}}}}}if(c==null){c=""}return c}function getLastInstance(c){var g=processName(c);var a=0;var f=-1;var b;var d;for(var e in parent.sessionDictionary){if(e.toUpperCase().indexOf(g)==0){b=e.substring(g.length);if(b.indexOf("[")==0&&b.indexOf("]")>0){f=b.indexOf("]");d=b.substring(1,f);if(parseInt(d)>a){a=parseInt(d)}}}}return a}function getFunctionName(d,e){var b="";if(d.indexOf("()")==d.length-2){var c=d.lastIndexOf(".");var a;if(e){a=d.lastIndexOf("(")}else{a=d.length}b=d.substring(c,a)}return b}function getBasePropertyName(a){var b;if(a&&a.length>0){if(a.indexOf("()")==a.length-2){b=a.substring(0,a.lastIndexOf("."))}else{b=a}}else{b=""}return b}function getSessionValueForPresentation(a){return getSessionValue(a,true)}function getSessionValue(b,d,a){if(b){if(d==null){d=false}var c;if(b.indexOf("SYS")>-1){c=lookupDateTimeSystemWords(b)}else{if(b.indexOf("()")>0&&b.indexOf("()")==b.length-2){b=processName(b);c=lookupFunctionValues(b,d)}else{b=processName(b);c=parent.sessionDictionary[b];if(a&&(c==null||c=="")){c=get(b)}if(c&&c.length>0){if(c.indexOf("$$")==0){c=tokenReplace(c)}else{c=formatValue(b,c,d)}}else{if(c){c=formatValue(b,c,d)}else{c=""}}}}return c}else{return""}}function setSessionValueForPresentation(c,b,a){return setSessionValue(c,b,true,a)}function setDataGroupInstance(c,a){var b=processPGName(c);parent.dataGroupInstances[b]=a;parent.dataGroupInstancesValid[b]=true}function setDefaultSessionValue(a,b){setSessionValue(a,b,false,true)}function setSessionValue(e,i,f,b){e=processName(e);var a;if(isDatePartFunctionName(e)){a=getBasePropertyName(e)}else{a=e}if(i!=null){i=""+i}if(i&&i.length>0&&e&&e.length>0){var h=getPropertyAttribute(a,parent.DATA_TYPE_KEY);if(f==null){f==false}if(f){if(h!=null&&h=="Decimal"){i=replaceSymbol(i,a,"decimalSymbol",".");i=replaceSymbol(i,a,"digitGroupSymbol","")}if(h!=null&&h=="Number"){i=replaceSymbol(i,a,"digitGroupSymbol","")}if(h!=null&&h=="Date"){var d=new Array();var g=new Array();var j=new Array();if(e.indexOf("()")==-1||e.indexOf(DATE_FN)>0){g=getDateTimePresAttributes(a,"datePart",3);j=getDateTimePresAttributes(a,"dateSeparator",2);d=splitDateTimeIntoParts(a,i,g,j);i=getFormattedDateTimeString(d,DEFAULT_DATETIME_ORDER,DEFAULT_SEPARATOR_ORDER,"00");e=a}else{if(e.indexOf(TIME_FN)>0){g=getDateTimePresAttributes(a,"timePart",3);if(j&&j.length>0){j[j.length]=" "}j=getDateTimePresAttributes(a,"timeSeparator",2);d=splitDateTimeIntoParts(a,i,g,j);i=getFormattedDateTimeString(d,DEFAULT_DATETIME_ORDER,DEFAULT_SEPARATOR_ORDER,"00")}else{if(isDatePartFunctionName(e)){g[0]=getFunctionName(e,false);d=splitDateTimeIntoParts(a,i,g);i=getFormattedDateTimeString(d,DEFAULT_DATETIME_ORDER,DEFAULT_SEPARATOR_ORDER,"00")}}}}}i=i.replace(/&#013;/g,"\r\n");if(!b){parent.sessionDictionary[a]=i}put(a,i);if(h!=null&&h=="List"){var c=getPropertyAttribute(a,parent.LIST_NAME_KEY);updateListFunctionValues(a,c,i,b)}}else{removeSessionValue(a)}}function replaceSymbol(d,f,c,e){var b=getPresentationAttribute(f,c);if(d&&b&&(b!=e)){while(d.indexOf(b)>-1){var a=new RegExp("\\"+b);d=d.replace(a,e)}}return d}function getGlobalVariable(a){if(a!=null&&a.length>0){var b=parent.globalVariables[a];if(b==null){b=""}return b}}function setGlobalVariable(b,a){if(b!=null&&b.length>0){parent.globalVariables[b]=a}}function getSessionVariable(a){if(a!=null&&a.length>0){var b=parent.sessionVariables[a];if(b==null){b=""}return b}}function setSessionVariable(b,a){if(b!=null&&b.length>0){parent.sessionVariables[b]=a}}function resetGlobalVariables(){parent.globalVariables=new Array()}function resetSessionVariables(){parent.sessionVariables=new Array()}function formatValue(b,c,e){if(c!=null&&b!=null&&b.length>0){var d=getBasePropertyName(b);var a=getPropertyAttribute(d,parent.DATA_TYPE_KEY);if(a){if(a=="Decimal"){c=setScale(d,c);if(e){c=setDecimalPresentation(d,c)}}else{if(a=="Date"){if(e){c=setDateTimePresentation(b,c)}else{c=getDateTimePart(b,c)}}else{if(a=="Number"){if(e){c=setNumberPresentation(b,c)}}}}}}return(c)}function setScale(a,f){if(f){var d=getPropertyAttribute(a,parent.DEC_PLACES_KEY);var g=getPropertyAttribute(a,parent.ROUNDING_KEY);var c;f=""+f;if(f!="0"){var j=0;for(j=0;j<f.length;j++){if(f.charAt(j)!="0"){if(f.charAt(j)=="."){j--}break}}f=f.substring(j)}f=f.replace(/\,/,"");if(f.indexOf(".")>-1){c=f.substring(f.indexOf(".")+1).length}var b;if(d==c||parent.ROUND_UNCHANGED_VAL==g){b=f}else{if(d>c){for(var e=c;e<d;e++){b=b+"0"}}else{b=parseFloat(f)*Math.pow(10,d);var h=parseFloat(b-(parseInt(b)));if(parent.ROUND_UP_VAL==g){b=b+1}else{if(parent.ROUND_NEAREST_UP_VAL==g){if(h>=0.5){b=b+1}}else{if(parent.ROUND_NEAREST_DOWN_VAL==g){if(h>0.5){b=b+1}}}}b=parseInt(b);b=parseFloat(b)/Math.pow(10,d);b=""+b;if(d>0){c;if(b.indexOf(".")>-1){c=f.substring(f.indexOf(".")+1).length}else{c=0;b+="."}if(c<d){for(var e=c;e<d;e++){b=b+"0"}}}}}return(b)}else{return""}}function setNumberPresentation(e,c){if(c){c=""+c;if(c.length>0){var d=getPresentationAttribute(e,"digitGroupSymbol");if(d&&d.length>0){var a=c.indexOf(".");if(a==-1){a=c.length}c=c.replace(/\,/,"");var b=a-3;while(b>0){c=c.substring(0,b)+d+c.substring(b);b=b-3}}}}if(!c){c=""}return(c)}function setDecimalPresentation(c,b){if(b){b=""+b;b=setNumberPresentation(c,b);if(b.length>0&&b.indexOf(".")>=0){var a=getPresentationAttribute(c,"decimalSymbol");if(a&&a.length>0&&a!="."){b=b.replace(/\./,a)}}}if(!b){b=""}return(b)}function getDateTimePart(e,d){var g="";var b=new Array();var c=new Array();var h=getBasePropertyName(e);var f=splitDateTimeIntoParts(h,d,DEFAULT_DATETIME_ORDER,DEFAULT_SEPARATOR_ORDER);if(e&&d){if(isDatePartFunctionName(e)){var a=getFunctionName(e,false);if(DATE_FN==a){b=DEFAULT_DATE_ORDER;c=DEFAULT_DATE_SEP_ORDER;g=getFormattedDateTimeString(f,b,c)}else{if(TIME_FN==a){b=DEFAULT_TIME_ORDER;c=DEFAULT_TIME_SEP_ORDER;g=getFormattedDateTimeString(f,b,c,"00")}else{g=f[a]}}}else{g=d}}if(g==null||g.length==0){g=d}return g}function setDateTimePresentation(f,g){var a=getBasePropertyName(f);var e=splitDateTimeIntoParts(a,g,DEFAULT_DATETIME_ORDER,DEFAULT_SEPARATOR_ORDER);var i=false,j=false;var c;if(isDatePartFunctionName(f)){var b=getFunctionName(f,false);if(DATE_FN==b){i=true}else{if(TIME_FN==b){j=true}else{c=e[b]}}}else{if(getPresentationAttribute(a,"showDate")=="true"){i=true}if(getPresentationAttribute(a,"showTime")=="true"){j=true}}var d,h;if(i){d=getDateTimePresAttributes(a,"datePart",3);h=getDateTimePresAttributes(a,"dateSeparator",2);if(numParts(d)==0){c=getDateTimePart(f,g)}else{c=getFormattedDateTimeString(e,d,h)}}if(j){if(c&&c.length>0){c+=" "}d=new Array(),h=new Array();d=getDateTimePresAttributes(a,"timePart",3);h=getDateTimePresAttributes(a,"timeSeparator",2);if(numParts(d)==0){c=getDateTimePart(f,g)}else{c=getFormattedDateTimeString(e,d,h,"00")}}if(!c){c=g}return c}function numParts(a){num=0;if(a){for(part in a){num++}}return num}function splitDateTimeIntoParts(e,f,a,d){var c;var b;if(parent.sessionDictionary[e]){b=parent.sessionDictionary[e];c=parseDateTimeParts(b,DEFAULT_DATETIME_ORDER,DEFAULT_SEPARATOR_ORDER);return parseDateTimeParts(f,a,d,c)}else{return parseDateTimeParts(f,a,d,DEFAULT_SEPARATOR_ORDER)}}function parseDateTimeParts(a,b,h,g){var e;var k=0;var j=0;var d;var c;if(g){e=g}else{e=new Array()}if(h){for(var f=0;f<=h.length&&a.length>0;f++){if(f==h.length){j=a.length}else{j=a.indexOf(h[f]);if(j==-1){j=a.length}}d=a.substring(0,j);c=b[f];e[c]=d;a=a.substring(j+1)}}else{c=b[0];e[c]=a}return e}function getDateTimePresAttributes(d,g,a){var b=new Array();var e="";var f="";for(var c=0;c<a;c++){f=g+(c+1);if(getPresentationAttribute(d,f)!=null){e=getPresentationAttribute(d,f);if(f.indexOf("Part")>=0){if(e){e=PART_LOOKUP[e]}}if(e&&e.length>0){b[c]=e}}}return b}function getFormattedDateTimeString(f,c,e,b){var g="";for(var d=0;d<c.length;d++){var a=c[d];if(a==NOT_REQUIRED){break}else{if(d>0&&e[d-1]){g+=e[d-1]}if(f[a]){g+=f[a]}else{if(b){g+=b}}}}return g}function getPropertyAttribute(e,c){var f;e=processName(e);var b=changeSubsToOne(e);var a=parent.dataDictionary[b];if(a!=null){var d=a[parent.DATA_TYPE_KEY];if(d=="Decimal"||d=="Number"||d=="Text"||d=="Date"||d=="List"){f=a[c]}else{a=parent.customTypes[d];f=a[c]}}if(f==null){f=""}return f}function getPresentationAttribute(d,c){var e;if(d&&d.length>0&&c&&c.length>0){var b=changeSubsToOne(d);var a=attributes[b];if(a!=null){e=a[c]}}if(e==null){e=""}return e}Object.size=function(c){var b=0,a;for(a in c){if(c.hasOwnProperty(a)){b++}}return b};function hasPageErrors(){var a=Object.size(pageErrors);return(a>0)}function goForwardsOffline(b,d){if(d!=null&&d!=""){if(!confirm(d)){return false}}if(hasPageErrors()){return false}var c=setCallBack("goForwardsOfflineCallBack",arguments);var a=setSessionDictionary(copySessionDictionary());var e=setSession(copySession());updateUserValues();populateSystemWordsIntoDictionary();c.m_newSessionDictionary=setSessionDictionary(a);c.m_newSession=setSession(e);act=OFFLINE_CONTROLLER;goForwards(b)}function goForwardsOfflineCallBack(b){var c=b.m_args[0];var g=parent.CURRENT_PAGE;setSessionDictionary(b.m_newSessionDictionary);setSession(b.m_newSession);var d=new Function(g+"_postphase()");try{d()}catch(h){var a=g.split("_");if(a.length==3){var g=a[0]+"_"+a[1];var f=parent.navPageSections[g];if(f.sectionIndex==f.numSections-1){f.sectionIndex=0;d=new Function(g+"_postphase()");d()}else{var e=f.sectionIndex*1;e++;f.sectionIndex=e;evaluateGoto("Go Forward to a Named Phase",g,c)}}}act=parent.navRoute[parent.navIndex+1];if(act!=null){parent.navIndex++;parent.navInsertIndex=parent.navIndex}else{if(parent.jumpIndex>=0){if(parent.remainingRules!=null){parent.returnLastResultMode=true;remainingRules()}act=parent.navRoute[parent.navIndex+1];if(act!=null){parent.navIndex++;parent.navInsertIndex=parent.navIndex}else{act=parent.navRoute[parent.jumpIndex];parent.navRoute=parent.navRoute.slice(0,parent.jumpIndex+1);parent.navIndex=parent.jumpIndex;parent.jumpIndex=-1}}else{act=parent.errorPhase}}var i=parent.undoRulesStack[g];if(i==null){parent.undoRulesStack[g]=undoRules}else{parent.undoRulesStack[g]=i+"|"+undoRules}setMainForm(act)}function goBackOffline(a,c){if(c!=null&&c!=""){if(!confirm(c)){return false}}var b=setCallBack("goBackOfflineCallBack",arguments);act=OFFLINE_CONTROLLER;goBack(a)}function goBackOfflineCallBack(b){var a=b.m_args[0];returnToPage(a)}function returnToPage(c,e){if(e==null||e.length==0){e=parent.navRoute[parent.navIndex-1]}do{var n=parent.navRoute[parent.navIndex];var a=n.split("_");if(a.length==3){var n=a[0]+"_"+a[1];var h=a[2];if(h>0){h--}var k=parent.navPageSections[n];k.sectionIndex=h}parent.navRoute.splice((parent.navIndex),1);act=parent.navRoute[--(parent.navIndex)];parent.navInsertIndex--;var o=parent.undoRulesStack[act];if(o!=null&&o.length>0){var b=splitstring(o,"|",false);var j=b[b.length-1];var g=splitstring(j,"^",false);for(var l=0;l<g.length;l++){var m=new Function(g[l]);m()}var d=o.lastIndexOf("|");if(d<0){parent.undoRulesStack[act]=""}else{parent.undoRulesStack[act]=parent.undoRulesStack[act].substring(0,d)}}if(act==null){act=parent.errorPhase}}while(e!=parent.navRoute[parent.navIndex]&&parent.navIndex>0);setMainForm(act)}function copySessionDictionary(){var a=new Array();for(var b in parent.sessionDictionary){a[b]=parent.sessionDictionary[b]}return(a)}function getSessionDictionary(){return(parent.sessionDictionary)}function setSessionDictionary(b){var a=parent.sessionDictionary;parent.sessionDictionary=b;return(a)}function copySession(){var b=new Array();for(var a in session){b[a]=session[a]}return(b)}function getSession(){return(session)}function setSession(a){var b=session;session=a;return(b)}function setCallBack(b,a){parent.CALLBACK_OBJECT=new Object();parent.CALLBACK_OBJECT.m_func=b;parent.CALLBACK_OBJECT.m_args=a;return(parent.CALLBACK_OBJECT)}function performCallBack(){var a=parent.CALLBACK_OBJECT.m_func+"(parent.CALLBACK_OBJECT)";var b=new Function(a);b()}function buttonClickedOffline(k,n,d,e,i,b,f,g,c,j,o){if(k=="__Forward"){goForwardsOffline("")}else{if(k=="__Back"){goBackOffline("")}else{if(c!=null&&c!=""){if(!confirm(c)){return false}}if(hasPageErrors()){return false}var m=setCallBack("buttonClickedOfflineCallBack",arguments);var h=setSessionDictionary(copySessionDictionary());var l=setSession(copySession());if(f){updateUserValues()}if(k.indexOf("_inst")>0){var p=k.substring(k.indexOf("_inst")+5);var a=document.getElementById(b);var q=getFormTableElement(a);if(q.selector){setSessionValue(q.selector,p)}}populateSystemWordsIntoDictionary();m.m_newSessionDictionary=setSessionDictionary(h);m.m_newSession=setSession(l);act=OFFLINE_CONTROLLER;buttonClicked(k,n,d,e,i,b,f,g,c,j,true,o)}}}function buttonClickedOfflineCallBack(b){var n=b.m_args[0];var o=b.m_args[1];var e=b.m_args[2];var f=b.m_args[3];var j=b.m_args[4];var c=b.m_args[5];var g=b.m_args[6];var m=parent.CURRENT_PAGE;setSessionDictionary(b.m_newSessionDictionary);setSession(b.m_newSession);var i=parent.navRoute.length;if(n.indexOf("__")==0){n=n.substring(2)}if(n.indexOf("_inst")>0){n=n.substring(0,n.indexOf("_inst"))}if(n.indexOf(" ")>0){n=n.replace(/\s+/g,"")}var d=new Function(m+"_"+n+"()");try{d()}catch(l){var a=m.split("_");if(a.length==3){var k=a[0]+"_"+a[1];d=new Function(k+"_"+n+"()");d()}}var h=parent.navRoute.length;if(i==h||i>h){act=parent.navRoute[parent.navIndex]}else{act=parent.navRoute[++(parent.navIndex)]}parent.navInsertIndex=parent.navIndex;setMainForm(act)}function showHelpOffline(d,c){var a=unescape(getResourcePath(c,getVariable(c,"helpPagePath")));var b=tokenReplace(a+"?"+d);window.open(b,"helpwin","toolbar=no,directories=no,status=yes,scrollbars=yes,resizeable=yes,resize=yes,menubar=no,height=300,width=600").focus()}function loadForm(a){var b=a.elements.APPLICATIONS.options[a.elements.APPLICATIONS.selectedIndex].value;parent.APP_FORM=b;loadFile();setMainForm(parent.navRoute[0])}function setMainForm(a){window.location="..\\"+a+".html"}function loadFile(){var d,e,c,f;if(parent.APP_FORM!=null){var c=APP_DIRECTORY+"/"+parent.APP_FORM;parent.initOfflineSession();parent.initOfflineApplication();var b=new ActiveXObject("Adodb.Stream");b.Open;b.Type=2;b.Charset="UTF-8";b.loadFromFile(c);var a="";var h="";var g=-1;var i=0;while(!b.EOS){line=trim(b.ReadText(-2));i++;if(line.length>0){g=line.indexOf("=");if(g>-1){a=trim(line.substring(0,g));if(a.indexOf(SELECT_LIST_PREFIX)!=0&&a.indexOf(UNSELECT_LIST_PREFIX)!=0){h=trim(line.substring(g+1));put(a,h);setSessionValue(a,h)}}else{alert(getMsg("","FailedLoadAppMessage","QUESTION_CONSTRAINT="+i));break}}}b.close();alert("Successfully loaded "+parent.APP_FORM)}return(true)}function saveOfflineForm(){if(buttonsEnabled()){updateUserValues();var a=getFormElems();if(mandCheckElems(a)&&formatCheckElems(a)){if(writeFile()){return true}}}return(false)}function writeFile(){if(parent.APP_FORM==null||parent.APP_FORM==""){if(!createNewAppFile()){return false}}var b=APP_DIRECTORY+"/"+parent.APP_FORM;var a=new ActiveXObject("Adodb.Stream");a.Open;a.Type=2;a.Charset="UTF-8";for(name in parent.sessionDictionary){if((""+name).length>0){var c=""+parent.sessionDictionary[name];if(c.indexOf("function(")<0){c=c.replace(/\r\n/g,"&#013;");a.WriteText(name+"="+c,1)}}}for(name in parent.sessionVariables){if((""+name).length>0){var c=""+parent.sessionVariables[name];if(c.indexOf("function(")<0){c=c.replace(/\r\n/g,"&#013;");a.WriteText("SES_"+name+"="+c,1)}}}a.SaveToFile(b,2);a.close();alert("Data successfully saved to "+b);return(true)}function createNewAppFile(){var b;setFormName();if(parent.APP_FORM==""){return false}else{if(parent.APP_FORM.indexOf(".app")==-1){parent.APP_FORM=parent.APP_FORM+".app"}var a=new ActiveXObject("Adodb.Stream");a.Open;a.Type=2;a.Charset="UTF-8";a.SaveToFile(APP_DIRECTORY+"/"+parent.APP_FORM,2);a.close();return true}}function setFormName(){parent.APP_FORM="";window.showModalDialog(getOfflineFileNamePagePath,window,"dialogHeight: 200px; dialogWidth: 300px; dialogTop: 250px; dialogLeft: 200px; edge: Raised; center: Yes; help: Yes; resizable: Yes; status: Yes;")}function showSavedAppForms(j){var c;var a;var d;var f;var k;var h=TXT_EXTENSION;var j;var b=APP_DIRECTORY;var i="";if(j.APPLICATIONS!=null){var e=new ActiveXObject("Scripting.FileSystemObject");if(e.FolderExists(b)){k=b;if(e.FolderExists(k)){c=e.GetFolder(k);a=c.Files;while(j.APPLICATIONS.options.length>0){j.APPLICATIONS.options.remove(0)}var g=0;for(f=new Enumerator(a);!f.atEnd();f.moveNext()){g++;d=f.item().name;fileExtension=d.substring(d.lastIndexOf("."),d.length);if(fileExtension==h){j.APPLICATIONS.options[j.APPLICATIONS.options.length]=new Option(d,d)}}if(g>0){j.APPLICATIONS.style.visibility="visible";top.frames["return"].document.getElementById("AppSelect").style.visibility="visible"}else{alert("There are no saved appliactions")}}}}}function setFileName(a){if(a.value==""||a.value.indexOf('"')>=0||a.value.indexOf(",")>=0){alert("Please enter a file name");a.focus()}else{window.dialogArguments.parent.APP_FORM=""+a.value;window.close()}}function checkReturn(){var a;var b=window.event;if(b.keyCode){a=b.keyCode}else{if(b.which){a=b.which}}if(a==13){setFileName(document.forms[0].fileTextField)}}function populateSystemWordsIntoDictionary(){var b=new Date();var j=b.getHours();var i;if(j<12){i="AM"}else{i="PM"}var e=formatDigits(b.getDate())+"/"+formatDigits(b.getMonth()+1)+"/"+formatDigits(b.getFullYear());var d=formatDigits(b.getHours())+":"+formatDigits(b.getMinutes())+":"+formatDigits(b.getSeconds());setSessionValue(SW_SYSAM_PM,i);setSessionValue(SW_SYSDATE,e);setSessionValue(SW_SYSDATETIME,e+" "+d);setSessionValue(SW_SYSDAY,formatDigits(b.getDate()));j=b.getHours();var c;if(j>=12&&j<=23){c=(j-12)}else{c=j}setSessionValue(SW_SYSHOUR,formatDigits(c));setSessionValue(SW_SYSHOUR_OF_DAY,formatDigits(b.getHours()));setSessionValue(SW_SYSMINUTE,formatDigits(b.getMinutes()));setSessionValue(SW_SYSMONTH,formatDigits(b.getMonth()+1));setSessionValue(SW_SYSSECOND,formatDigits(b.getSeconds()));setSessionValue(SW_SYSTIME,formatDigits(d));setSessionValue(SW_SYSTIMEMILLIS,formatDigits(b.getTime()));setSessionValue(SW_SYSYEAR,b.getFullYear());var a=document.getElementById("form1");var h=a.elements.PAGE.value;var f=h.split("_");setSessionValue(SW_PROCESS,f[0]);setSessionValue(SW_PHASE,f[1]);var g=unescape(getVariable("","rootContext"));setSessionValue(SW_PROJECTHOME,g)}function formatDigits(a){if(a<10){a="0"+a}return a}function evaluateGoto(){var e=arguments[0];var a=arguments[1];var c=arguments[2];var f=arguments[3];var h=arguments[4];var i=arguments[5];var g;if(f=="On Return"){if(!parent.returnLastResultMode){parent.remainingRules=new parent.rule(h,i);suspendExec=true}else{if(((g=parent.remainingRules)!=null)&&(g.ruleName==i)){parent.returnLastResultMode=false;parent.remainingRules=null;suspendExec=false;return}}}else{if(f=="Never"){parent.returnLastResultMode=false;suspendExec=true}}if(parent.navPageSections[a]!=null){var b=parent.navPageSections[a];var d;if(e=="Jump out to Named Phase"){d=0;b.sectionIndex=d}else{d=b.sectionIndex}a=a+"_"+d}if(e=="Go Forward to a Named Phase"){parent.navInsertIndex++;parent.navRoute=parent.navRoute.slice(0,parent.navInsertIndex).concat(a,parent.navRoute.slice(parent.navInsertIndex));if(debug){alert("GOTO RULE: Going to named phase "+a+". Phase stack looks like: "+parent.navRoute)}}else{if(e=="Go Back to Last Phase"){if(debug){alert("GOTO RULE: Going back to last phase")}returnToPage(c)}else{if(e=="Jump out to Named Phase"){if(debug){alert("GOTO RULE: Jumping out to phase "+a)}parent.jumpIndex=parent.navIndex;parent.navInsertIndex++;parent.navRoute=parent.navRoute.slice(0,parent.navInsertIndex).concat(a,parent.navRoute.slice(parent.navInsertIndex))}else{if(e=="Go Back to a Named Phase"){if(debug){alert("GOTO RULE: Going back to named phase "+a)}returnToPage(c,a)}}}}}function remainingRules(){var a=parent.remainingRules;if(a!=null&&a.ruleSet!=null&&a.ruleSet.length>0){evalString(a.ruleSet+"()")}}function evaluateSetDataItem(){if(parent.returnLastResultMode){return}var c=arguments[0];var d=arguments[1];var e=arguments[2];if(d=="Data Item"){e=getSessionValue(e)}else{if(d=="System Word"){e="$$"+e+"$"}else{if(d=="Data Group Instance"){var b=processPGName(e);e=parent.dataGroupInstances[b];if(e==null||e=="0"){e="1";parent.dataGroupInstances[b]="1";parent.dataGroupInstancesValid[b]=false}}else{if(d=="Variable"){e=getSessionVariable(e)}else{if(d=="Global Variable"){e=getGlobalVariable(e)}}}}}if(e!=null){e=""+e;var f=arguments[3];if(f=="Upper case"){e=e.toUpperCase()}else{if(f=="Lower case"){e=e.toLowerCase()}}var a=arguments[4];if(a=="true"){e=e.trim()}e=tokenReplace(e)}if(debug){alert("SET DATA ITEM RULE: Setting "+c+" with value "+e)}setSessionValue(c,e)}function evaluateSetVariable(){var b=arguments[0];var e=arguments[1];var c=arguments[2];var d=arguments[3];if(c=="Data Item"){d=getSessionValue(d)}else{if(c=="System Word"){d="$$"+d+"$"}else{if(c=="Data Group Instance"){d=parent.dataGroupInstances[processPGName(d)]}else{if(c=="Variable"){d=getSessionVariable(d)}else{if(c=="Global Variable"){d=getGlobalVariable(d)}}}}}var f=arguments[4];if(f=="Upper case"){d=d.toUpperCase()}else{if(f=="Lower case"){d=d.toLowerCase()}}d=tokenReplace(d);var a=arguments[5];if(a=="true"){d=d.trim()}if(b=="Variable"){setSessionVariable(e,d)}else{if(b=="Global Variable"){setGlobalVariable(e,d)}}if(debug){alert("SET DATA ITEM RULE: Setting "+e+" with value "+d)}}function copyPropertyGroup(h,k,u,m,d){var f,g,s,r,v,j,a,q,n;h=processName(h);k=processName(k);q=h.indexOf("[A]");n=k.indexOf("[A]");if(q>0||n>0){f=h.substring(0,q);g=k.substring(0,n);s="",r="";if((q+3)<h.length){s=h.substring(q+3)}if((n+3)<k.length){r=k.substring(n+3)}var e,t,p;p=f.indexOf("[");if(p>0){e=f.replace(/\[[0-9]+]/g,"[1]")}else{e=f}p=g.indexOf("[");if(p>0){t=g.replace(/\[[0-9]+]/g,"[1]")}else{t=g}j=parent.dataGroupMaxInstances[e];a=parent.dataGroupMaxInstances[t];for(var l=1;l<=j&&l<=a;l++){try{copyPropertyGroup(f+"["+l+"]"+s,g+"["+l+"]"+r,u,m,d)}catch(o){}}}else{for(var b in parent.sessionDictionary){if(b.indexOf(h)==0){var c=b.substring(h.length+1);v=c.split(".");if(v.length==1||d=="Y"){g=k+"."+c;var w=parent.sessionDictionary[b];if(u=="Upper case"){w=w.toUpperCase()}else{if(u=="Lower case"){w=w.toLowerCase()}}if(m=="true"){w=w.trim()}try{parent.sessionDictionary[g]=w}catch(o){}}}}}}function evaluateSetValue(){if(parent.returnLastResultMode){return}var h=arguments[0];var b=arguments[2];if(h=="Data Item"){var k=arguments[1];if(b=="Data Item"){evaluateSetDataItem(k,"Data Item",arguments[3],arguments[4],arguments[5])}else{if(b=="Value"){evaluateSetDataItem(k,"Value",arguments[3],arguments[4],arguments[5])}else{if(b=="System Word"){evaluateSetDataItem(k,"System Word",arguments[3],arguments[4],arguments[5])}else{if(b=="Data Group Instance"){evaluateSetDataItem(k,"Data Group Instance",arguments[3],arguments[4],arguments[5])}else{if(b=="Variable"){evaluateSetDataItem(k,"Variable",arguments[3],arguments[4],arguments[5])}else{if(b=="Global Variable"){evaluateSetDataItem(k,"Global Variable",arguments[3],arguments[4],arguments[5])}}}}}}}else{if(h=="Data Group Instance"){var g=tokenReplace(arguments[1]);g=processPGName(g);var j=""+arguments[3];if(b=="Data Item"||b=="System Word"){j=getSessionValue(arguments[3])}else{if(b=="Data Group Instance"){j=parent.dataGroupInstances[processPGName(arguments[3])]}else{if(b=="Variable"){j=getSessionVariable(arguments[3])}else{if(b=="Global Variable"){j=getGlobalVariable(arguments[3])}else{j=tokenReplace(arguments[3])}}}}try{var c=arguments[5];if(c=="true"){j=j.trim()}j=parseInt(j);if(debug){alert("SET VALUE RULE: Setting datagroup instance "+g+" to "+j)}parent.dataGroupInstances[g]=j;parent.dataGroupInstancesValid[g]=true}catch(f){}}else{if(h=="Variable"||h=="Global Variable"){evaluateSetVariable(h,arguments[1],b,arguments[3],arguments[4],arguments[5])}else{if(h=="Data Group"){var d=arguments[1];var i=arguments[3];var a=arguments[4];var c=arguments[5];var e=arguments[6];if(d!=null&&d.length>0&&i!=null&&i.length>0){copyPropertyGroup(i,d,a,c,e)}}else{alert("SetValue "+h+" not supported")}}}}}function evaluateArithmetic(){if(parent.returnLastResultMode){return}var dataItems=arguments[0];var operation=arguments[1];var result=arguments[2];if(operation=="Add"){operation="+"}else{if(operation=="Subtract"){operation="-"}else{if(operation=="Multiply"){operation="*"}else{if(operation=="Divide"){operation="/"}}}}var dataItemList=splitstring(dataItems,",",false);var expr="";for(var i=0;i<dataItemList.length;i++){var diName=dataItemList[i];var di_value;if(diName.indexOf("[A]")>0){var startPart=diName.substring(0,diName.indexOf("[A]"));var endPart=diName.substring(diName.indexOf("[A]")+3);var maxInst=getLastInstance(startPart);if(maxInst==0){expr+="0"}for(var j=1;j<=maxInst;j++){diName=startPart+"["+j+"]"+endPart;di_value=getSessionValue(diName);if(di_value==""){di_value=0}expr+=di_value;if(j<maxInst){expr+=operation}}}else{di_value=getSessionValue(diName);if(di_value==""){di_value=0}expr+=di_value}if(i<dataItemList.length-1){expr+=operation}}var answer=jsep.eval(expr);if(!answer||(""+answer).length==0){answer=0}if(debug){alert("ARITHMETIC RULE: Answer = "+answer)}setSessionValue(result,answer)}function evaluateSetProcessItemStatus(){if(parent.returnLastResultMode){return}var g=arguments[0];var n=arguments[1];var j=arguments[2];var f=arguments[3];var b=arguments[4];var m=arguments[5];var l=arguments[6];var c=arguments[7];var e=arguments[8];if(b=="Y"){if(j=="Y"){j=true}else{if(j="N"){j=false}}if(l=="Y"){l=true}else{if(l=="N"){l=false}}if(g=="Question"){parent.questionState[n]=j}else{if(g=="Phase"){var h=new parent.fieldState(j,l);parent.questionState["phase_"+n]=h}else{var h=new parent.fieldState(j,l);parent.questionState["process_"+n]=h}}if(debug){alert("SET PROCESS ITEM STATUS: Setting "+g+" "+n+" to be "+(j?"read only":"editable"))}}if(m=="Y"){if(f=="Y"){f=true}else{if(f="N"){f=false}}if(c=="Y"){c=true}else{if(c=="N"){c=false}}var a,i;if(g=="Question"){var k=new parent.fieldState(f,null,e);parent.questionMandatoryState[n]=k}else{if(g=="Phase"){var k=new parent.fieldState(f,c,e);parent.questionMandatoryState["phase_"+n]=k}else{var k=new parent.fieldState(f,c,e);parent.questionMandatoryState["process_"+n]=k}}if(debug){alert("SET PROCESS ITEM STATUS: Setting "+g+" "+n+" to be "+(f?"mandatory":"non mandatory"))}}var d=arguments[9];if(d==null||d==""||d=="Y"){undoRules+="evaluateSetProcessItemStatus('"+g+"', '"+n+"', '"+(j?"N":"Y")+"', '"+(f?"N":"Y")+"', '"+b+"', '"+m+"', '"+l+"', '"+c+"', '"+e+"', 'N');"}}function evaluateTextModifier(){if(parent.returnLastResultMode){return}var c=arguments[0];var e=tokenReplace(arguments[1]);var a=tokenReplace(arguments[2]);c=processName(c);var d=getSessionValue(c);if(e==null||e.length==0){e=0}else{e=e-1}if(a==null||a.length==0){a=d.length}else{a--}var b=d.substring(e,a);if(debug){alert("TEXT MODIFIER RULE: Modified dataItem "+c+" from value "+d+" to have a value of "+b)}setSessionValue(c,b)}function evaluateResetData(){if(parent.returnLastResultMode){return}var f=arguments[10];var o=arguments[11];if(f==null||f==""){f="Y"}var a=splitstring(arguments[5],",",false);var c=new Array();for(var h=0;h<a.length;h++){var b=getSessionValue(a[h]);c[a[h]]=b}if(arguments[0]==true||arguments[0]=="true"||arguments[0]=="Y"){if(debug){alert("RESET DATA RULE: Resetting session.")}parent.sessionDictionary=new Array()}if(arguments[1].length>0){if(debug){alert("RESET DATA RULE: Resetting dataItem "+arguments[1])}resetDataItem(processName(arguments[1]))}if(arguments[2].length>0){if(debug){alert("RESET DATA RULE: Resetting data group instance "+arguments[2])}var j=processPGName(arguments[2]);var k=parent.dataGroupInstances[j];parent.dataGroupInstances[j]="1";parent.dataGroupInstancesValid[j]=true;if(f=="Y"){undoRules+="evaluateResetDataUndo('data group instance', '"+j+"', '"+k+"');^"}}if(arguments[3].length>0){var j=tokenReplace(arguments[3]);j=processName(j);resetDataGroup(j)}if(arguments[4].length>0){var p=arguments[4];var n=parent.phaseDataItems[p];if(n!=null&&n.length>0){var m=n.split(",");for(var e=0;e<m.length;e++){resetPageDataItem(processName(m[e]),p)}}n=parent.phaseTableDataItems[p];if(n!=null&&n.length>0){var m=n.split(",");for(var e=0;e<m.length;e++){resetPageDataItem(m[e],p)}}}if(arguments[6].length>0){resetGlobalVariables()}if(arguments[7].length>0){resetSessionVariables()}if(arguments[8].length>0){var l=arguments[8].substring(0,arguments[8].length-5);l=l.toUpperCase();parent.removeSessionListValue(l)}if(arguments[9].length>0){var l=processName(arguments[9]);parent.removeSessionListValue(l)}if(arguments[11].length>0){var g=getVariable("","CURRENT_FOCUS")+"_ERRORMESSAGE";var d=document.getElementById(g);if(d){d.style.display="none";d.innerHTML="";delete pageErrors[g]}}for(var h in c){setSessionValue(h,c[h])}}function removeSessionValue(a){delete parent.sessionDictionary[a]}function removeSessionValues(b){for(var a in b){removeSessionValue(a)}}function resetDataItem(d){if(debug){alert("resetDataItem: Resetting data item "+d)}var a=new Array();a[d]=d;for(var c in parent.sessionDictionary){if(c!=d&&c.indexOf(d)==0){var b=c.substring(d.length);if(MATCH_PART_FUNCTIONS.exec(b)){a[c]=c}}}removeSessionValues(a)}function resetDataGroup(j){if(debug){alert("resetDataGroup: Resetting data group "+j)}var b=new Array();for(var i in parent.sessionDictionary){if(i.indexOf(j)==0){b[i]=i}}removeSessionValues(b);var c=j.substring(0,j.lastIndexOf("[")+1);var f=c.length;var d=parseInt(j.substring(j.lastIndexOf("[")+1,j.lastIndexOf("]")));var g=new Array();b=new Array();for(var i in parent.sessionDictionary){if(i.indexOf(c)==0){var a=i.indexOf("]",f);var h=parseInt(i.substring(f,a));if(h<d){continue}h--;var e=c+h+i.substring(a);g[e]=parent.sessionDictionary[i];b[i]=i}}removeSessionValues(b);for(var e in g){parent.sessionDictionary[e]=g[e]}}function evaluateResetDataUndo(b,a,c){if(b=="data group instance"){parent.dataGroupInstances[a]=c;parent.dataGroupInstancesValid[a]=true}}function resetPageDataItem(n,m){try{var k=n.replace(/\[[aAc]+]/g,"[C]");var f=k.indexOf("[C]");if(f>0){var b=k.substring(0,f);var a=k.substring(f+3);var g=parent.dataGroupMaxInstances[b.replace(/\[[0-9]+]/g,"[1]")];for(var e=1;e<=g;e++){k=(b+"["+e+"]"+a);resetPageDataItem(k,m)}}else{var d=n.split("|");k=d[0];var c=removeSuffixOrPrefixFromId(d[1]);var l=getNodeReadOnly(c);var i;d=m.split("_");if((i=parent.questionState["phase_"+m])!=null){l=fieldIsReadOnly(l,i.state,i.ignoreCurrentState)}else{if((i=parent.questionState["process_"+d[0]])!=null){l=fieldIsReadOnly(l,i.state,i.ignoreCurrentState)}else{if(parent.questionState[c]!=null){l=parent.questionState[c]}}}if(!l){setSessionValue(k,"")}}}catch(h){}}function offlineQuestionAction(e,a,m,k,t,c,n,o,h,l){var q=document.getElementById(a);if(q==null||!datePartsComplete(q)){return}k="";var i=getVariable(k,"focusValue"+a);if(!i){i=focusValue}setVariable(k,"focusValue"+a,"");var p=a+getElementValue(q);if(p!=null){setVariable(k,"focusValue"+a,p)}var g;if(o){g=o.srcElement}else{g=q}if(g&&questionIsValid(k,q)&&(i!=p)){e=e.replace(" ","");var u=g.name;var b=u.indexOf("[");var s=u.indexOf("]");if(b>0){var d=u.substring(0,b);var r=u.substring(b+1,s);parent.dataGroupInstances[d]=r;parent.dataGroupInstancesValid[d]=true;var f=parent.CURRENT_PAGE;var j=e;if(j.indexOf(" ")>0){j=j.replace(/\s+/g,"")}updateUserValues();update(j)}}}function evaluateExpression(){if(parent.returnLastResultMode){return}var exp=arguments[0];var diToSet=arguments[1];exp=tokenReplace(exp,false);var result=eval(exp);if(debug){alert("EVALUATE EXPRESSION RULE: Evaluating expression "+exp+". Result is "+result)}setSessionValue(diToSet,result)}function evaluateEvaluate(){if(parent.returnLastResultMode){return parent.lastEvaluateResult;parent.lastEvaluateResult=null}var val1=arguments[0];val1=tokenReplace(val1,true,false,true);var index=val1.indexOf(" AND ");while(index>=0){val1=val1.substring(0,index)+" && "+val1.substring(index+5);index=val1.indexOf(" AND ")}index=val1.indexOf(" OR ");while(index>=0){val1=val1.substring(0,index)+" || "+val1.substring(index+4);index=val1.indexOf(" OR ")}if(debug){alert("EVALUATE RULE: Evaluating expression "+val1+".")}var result=jsep.eval(val1);if(debug){alert("Result is "+result)}repeatState=result;parent.lastEvaluateResult=result;return result}function evaluateGroupIncrementor(){if(parent.returnLastResultMode){return parent.lastGroupIncrementorResult;parent.lastGroupIncrementorResult=null}var i=arguments[0];var g=arguments[1];var e=arguments[2];var d=arguments[3];if(d==null||d==""){d="Y"}var j;if(g==null){g="++"}if(e==null){e="1"}i=processPGName(i);var h=parent.dataGroupInstances[i];if(h==null||h=="undefined"||h=="0"){h="1";parent.dataGroupInstances[i]="1";parent.dataGroupInstancesValid[i]=false}var c=parseInt(h);if(debug){alert("GROUP INCREMENTOR RULE: Current group instance for "+i+" is "+c)}var f=getMaxInstances(i);var b=parseInt(f,10);var a=parseInt(e,10);if(g=="++"&&(c+a)>b){if(debug){alert("GROUP INCREMENTOR RULE: Failed to increment group instance for "+i)}j=false}else{if(g!="++"&&(c-a)<1){if(debug){alert("GROUP INCREMENTOR RULE: Failed to decrement group instance for "+i)}j=false}else{if(!parent.dataGroupInstancesValid[i]){c=1}else{if(g=="++"){c=c+a}else{c=c-a;if(c<1){c=1}}}parent.dataGroupInstances[i]=""+c;parent.dataGroupInstancesValid[i]=true;if(debug){alert("GROUP INCREMENTOR RULE: Incremented group instance for "+i+" by "+a+" to "+c)}if(d=="Y"){if(debug){alert("GROUP INCREMENTOR RULE: Adding undo rule")}undoRules+="evaluateGroupIncrementorUndo('"+i+"', '"+g+"', '"+e+"');^"}j=true}}parent.lastGroupIncrementorResult=j;repeatState=j;return j}function evaluateGroupIncrementorUndo(){var f=arguments[0];var c=arguments[1];var b=arguments[2];if(b==null||b==""){b="1"}var d=parseInt(b);f=processPGName(f);var a=parent.dataGroupInstances[f];var e=parseInt(a);if(c=="++"){e=e-d;if(e<1){e=1}}else{e=e+d}if(debug){alert("UNDO GROUP INCREMENTOR RULE: Changing group instance for "+f+" to "+e)}parent.dataGroupInstances[f]=""+e;parent.dataGroupInstancesValid[f]=true}function evaluateIncrementor(){if(parent.returnLastResultMode){return parent.lastIncrementorResult;parent.lastIncrementorResult=null}var d=arguments[0];var g=arguments[1];var b=processName(arguments[2]);var c=arguments[3];if(c==null||c==""){c="1"}var e=arguments[4];if(e==null||e==""){e="Y"}var f=true;if(d=="Data Group Instance"){if(g=="Increment"){f=evaluateGroupIncrementor(b,"++",c,e)}else{f=evaluateGroupIncrementor(b,"--",c,e)}}else{if(d=="Data Item"){var h=getPropertyAttribute(b,parent.DATA_TYPE_KEY);var a=getSessionValue(b);if(a==null||a.length==0){a=0}if(g=="Increment"){if(h=="Date"){var a=rollDate(b,a,c,g,DAY_FN)}else{a=parseInt(a)+parseInt(c)}if(e=="Y"){undoRules+="evaluateIncrementorUndo('"+b+"', '++', '"+c+"','"+d+"');^"}}else{if(h=="Date"){var a=rollDate(b,a,c,g,DAY_FN)}else{a=parseInt(a)-parseInt(c)}if(e=="Y"){undoRules+="evaluateIncrementorUndo('"+b+"', '--', '"+c+"','"+d+"');^"}}setSessionValue(b,""+a);f=true}else{if(d=="Variable"){var a=getSessionVariable(b);if(a==null||a.length==0){a=0}if(g=="Increment"){a=parseInt(a)+parseInt(c);if(e=="Y"){undoRules+="evaluateIncrementorUndo('"+b+"', '++', '"+c+"','"+d+"');^"}}else{a=parseInt(a)-parseInt(c);if(e=="Y"){undoRules+="evaluateIncrementorUndo('"+b+"', '--', '"+c+"','"+d+"');^"}}setSessionVariable(b,""+a);f=true}}}parent.lastIncrementorResult=f;return f}function evaluateIncrementorUndo(){var e=arguments[0];var d=arguments[1];var a=arguments[2];var c=arguments[3];var f=getPropertyAttribute(e,parent.DATA_TYPE_KEY);var b;if(c=="Data Item"){b=getSessionValue(e)}else{if(c=="Variable"){b=getSessionVariable(e)}}if(d=="++"){if(f=="Date"){b=rollDate(e,b,a,"Decrement",DAY_FN)}else{b=parseInt(b)-parseInt(a)}}else{if(f=="Date"){b=rollDate(e,b,a,"Increment",DAY_FN)}else{b=parseInt(b)+parseInt(a)}}if(debug){alert("UNDO INCREMENTOR RULE: Changing group instance for "+e+" to "+b)}if(c=="Data Item"){setSessionValue(e,""+b)}else{if(c=="Variable"){setSessionVariable(e,""+b)}}}var repeatState=true;function setRepeatState(a){repeatState=a}function evaluateRepeat(){if(parent.returnLastResultMode){return parent.lastRepeatResult}var g=arguments;var h=g[0];if(h=="RUN_RULES"){parent.lastRepeatResult=repeatState;return repeatState}else{if(h=="DATA_GROUP"){if(g.length==1){return true}var i=g[1];var a=tokenReplace(g[2]);var c=tokenReplace(g[3]);var b=g[4];var f=g[5];var d=g[6];var k=processPGName(i);if(d==0){if(parseInt(a)>parseInt(c)){return false}else{parent.dataGroupInstances[k]=a;parent.dataGroupInstancesValid[k]=true;return true}}else{if(i==null){return true}var e=parent.dataGroupInstances[k];var j=parseInt(e)+parseInt(b);if(j<=parseInt(c)){parent.dataGroupInstances[k]=""+j;return true}else{if(f=="Y"){parent.dataGroupInstances[k]=a;parent.dataGroupInstancesValid[k]=true}return false}}}else{alert("Repeat type unknown: "+h)}}}function evaluateContainer(){if(parent.returnLastResultMode){return parent.lastContainerResult}parent.lastContainerResult=true;return true}function evaluateSetQuestionInError(){var b=arguments[0];var c=getVariable("","CURRENT_FOCUS")+"_ERRORMESSAGE";var a=document.getElementById(c);if(a){a.innerHTML=b;a.style.display="";pageErrors[c]="Y"}}function evaluateAddToList(){if(parent.returnLastResultMode){return parent.lastAddToListResult}var l=true;var d=arguments[0];var z;var x=false;if(d=="Single"){var c=arguments[1];z=arguments[9];if(z&&z=="Y"){x=true}var A="";if(c=="Data Item"){A=processName(arguments[2])}else{if(c=="List"){A=arguments[2];if(A.indexOf(" List")==A.length-5){A=A.substring(0,A.length-5);A=A.toUpperCase()}else{l=false}}}if(l){var k=arguments[3];var f=arguments[4];var B=arguments[5];var j=splitstring(arguments[6],",",false);var g=new Array();if(arguments[7].indexOf('"')==0){g.push(arguments[7].substring(1,arguments[7].length-1))}else{g=splitstring(arguments[7],",",false)}var y=null;var b=arguments[8];if(b!=null&&b.length>0){y=splitstring(b,",",false)}for(var v=0;v<j.length&&v<g.length&&(y==null||v<y.length);v++){var a=new ListPart(k,j[v]);var h=new ListPart(f,g[v]);var e=null;if(y!=null){e=new ListPart(B,y[v])}else{e=new ListPart(null,null)}if(a.multi&&h.multi){var q=null;var o=null;var m="";while(true){if(a.anyMoreInstances()&&h.anyMoreInstances()){if(a.multiInstance){var n=processPGName(a.propertyGroupName);parent.dataGroupInstances[n]=a.startInstance;parent.dataGroupInstancesValid[n]=true;q=a.getValue()}else{q=""+a.startInstance}if(h.multiInstance){var n=processPGName(h.propertyGroupName);parent.dataGroupInstances[n]=h.startInstance;parent.dataGroupInstancesValid[n]=true;o=h.getValue()}else{o=""+h.startInstance}if(e.type!=null){if(e.multiInstance){var n=processPGName(e.propertyGroupName);parent.dataGroupInstances[n]=e.startInstance;parent.dataGroupInstancesValids[n]=true;m=e.getValue()}else{m=""+e.startInstance}}if((q!=null)&&(o!=null)){parent.addSessionListValue(A,q,o,m,x)}a.nextInstance();h.nextInstance();e.nextInstance()}else{break}}if(a.multiInstance){var n=processPGName(a.propertyGroupName);parent.dataGroupInstances[n]=a.initialPropertyGroupInstance;parent.dataGroupInstancesValid[n]=true}if(h.multiInstance){var n=processPGName(h.propertyGroupName);parent.dataGroupInstances[n]=h.initialPropertyGroupInstance;parent.dataGroupInstancesValid[n]=true}if(e.multiInstance){var n=processPGName(e.propertyGroupName);parent.dataGroupInstances[n]=e.initialPropertyGroupInstance;parent.dataGroupInstancesValid[n]=true}}else{parent.addSessionListValue(A,tokenReplace(a.getValue()),tokenReplace(h.getValue()),tokenReplace(e.getValue()),x)}}}}else{if(d=="Import"){var c=arguments[1];var u=arguments[3];u=tokenReplace(u);z=arguments[4];if(z&&z=="Y"){x=true}if(c=="Data Item"){A=processName(arguments[2])}else{if(c=="List"){A=arguments[2];if(A.indexOf(" List")==A.length-5){A=A.substring(0,A.length-5)}}}var w=new ActiveXObject("Adodb.Stream");w.Open;w.Type=2;w.Charset="UTF-8";w.loadFromFile(u);var C="";var t="";var r=-1;var s=0;while(!w.EOS){line=trim(w.ReadText(-2));s++;if(line.length>0){r=line.indexOf(",");if(r>-1){var p=splitstring(line,",",false);if(p.length==2){p.push("")}if(s==1){parent.addSessionListValue(A.toUpperCase(),p[0],p[1],p[2],x)}else{parent.addSessionListValue(A.toUpperCase(),p[0],p[1],p[2],false)}}}}}}parent.lastAddToListResult=l;repeatState=l;return l}function ListPart(d,i){this.getValue=function(){var m="";if(this.type!=null&&this.value!=null&&this.type=="Data Item"){m="$$"+processName(this.value)+"$"}else{if(this.type!=null&&this.value!=null&&this.type=="Variable"){m="$$!"+this.value+"$"}else{m=(this.value==null)?"":this.value}}return m};this.anyMoreInstances=function(){return((this.incrementInstance&&(this.startInstance<=this.endInstance))||(!this.incrementInstance&&(this.startInstance>=this.endInstance)))};this.nextInstance=function(){if(this.incrementInstance){this.startInstance++}else{this.startInstance--}};this.multi=false;this.multiInstance=false;this.startInstance=1;this.endInstance=1;this.propertyGroupName=null;this.type=d;this.initialPropertyGroupInstance=null;this.incrementInstance=true;this.value=i;if(d!=null&&d=="Data Item"&&i!=null&&i.indexOf("[A]")>0){var c=i.indexOf("[A]");this.propertyGroupName=i.substring(0,c);this.value=i.substring(0,c)+"[C]"+i.substring(c+3);this.endInstance=getLastInstance(this.propertyGroupName);this.startInstance=1;this.multiInstance=true;this.multi=true}else{if(d!=null&&d=="Data Item"&&i!=null&&i.indexOf("...")>-1){var c=i.indexOf("...");var k=i.substring(0,c);var e=k.lastIndexOf("[");var j=k.substring(e+1);this.startInstance=(j=="")?1:parseInt(j,10);this.propertyGroupName=k.substring(0,e);var b=i.substring(c);var h=b.indexOf("]");b=b.substring(3,h);var l=getMaxInstances(k);this.endInstance=(b=="")?l:parseInt(b,10);this.value=i.substring(0,e)+"[C]"+i.substring(c+h+1);this.multiInstance=true;this.multi=true}else{if(i!=null&&i.indexOf("...")>-1){var a=i.indexOf("...");if(a>-1){var f=i.substring(0,a).replace(/^\s+|\s+$/g,"");var g=i.substring(a+3).replace(/^\s+|\s+$/g,"");if(d=="Data Item"){this.startInstance=parseInt(getSessionValue(f),10)}else{if(d=="Variable"){this.startInstance=parseInt(getSessionVariable(f),10)}else{this.startInstance=parseInt(tokenReplace(f),10)}}if(d=="Data Item"){this.endInstance=parseInt(getSessionValue(g),10)}else{if(d=="Variable"){this.endInstance=parseInt(getSessionVariable(g),10)}else{this.endInstance=parseInt(tokenReplace(g),10)}}this.multi=true}}}}if(this.multi){this.incrementInstance=(this.endInstance>=this.startInstance);this.initialPropertyGroupInstance=1;if(this.multiInstance){this.initialPropertyGroupInstance=parent.dataGroupInstances[processPGName(this.propertyGroupName)];if(this.initialPropertyGroupInstance<1){this.initialPropertyGroupInstance=1}}}}function incQ(a){setVariable(a,"AJAX_QUEUE",0)};